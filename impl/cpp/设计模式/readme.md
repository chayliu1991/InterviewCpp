



# 设计原则

SOLID 原则：

- SRP，单一职责（Single ResponsibilityPrinciple）
- OCP，开闭（Open Closed Principle）
- LSP，里氏替换（Liskov Substitution Principle）
- ISP，接口隔离（Interface-Segregation Principle）
- DIP，依赖反转，有的时候也叫依赖倒置（Dependency Inversion Principle）

![](D:\share\InterviewCpp\impl\cpp\img\design_principle.png)

单一职责原则，简单来说就是“不要做多余的事”，更常见的说法就是“高内聚低 耦合”。在设计类的时候，要尽量缩小“粒度”，功能明确单一，不要设计出“大而全”的 类。单一职责原则的一个反例是 C++ 标准库里的字符串类 string，它集成 了字符串和字符容器的双重身份，接口复杂。

开闭原则，通常的表述是“对扩展开放，对修改关闭”。应用开闭原则的关键是做好封装，隐藏内部的具体实现细节，然后开放足够的接口，这样外 部的客户代码就可以只通过接口去扩展功能，而不必侵入类的内部。C++ 语言里的 final 关键字也是实践开闭原则的“利器”，把它用在类和成 员函数上，就可以有效地防止子类的修改。

里氏替换原则，意思是子类必须能够完全替代父类。

接口隔离原则，它和单一职责原则有点像，但侧重点是对外的接口而不是内部的功能，目标是尽量简化、归并给外界调用的接口，避免写出大而不当的类。

依赖反转原则，上层要避免依赖 下层的实现细节，下层要反过来依赖上层的抽象定义。

## 设计模式

![](D:\share\InterviewCpp\impl\cpp\img\design_pattern.png)

### 创建型模式

创建型模式隐藏了类的实例化过程和细节，让对象的创建独立于系统的其他部分。

![](D:\share\InterviewCpp\impl\cpp\img\create_principle.png)



其中最有用的是单件和工厂。

#### 单件

单件很简单，要点在于控制对象的创建数量，只能有一个实例。

C++ 11 之后是直接使用函数内部的 static 静态 变量。C++ 语言会保证静态变量的初始化是线程安全的，绝对不会有线程冲突。

```
auto& instance() //@ 生产单件对象的函数
{
 static T obj; 	//@ 静态变量
 return obj; 	//@  返回对象的引用
}
```

#### 工厂模式

工厂模式指的是抽象工厂、工厂方法这两个模式，因为它们就像是现实世界里的工厂一样，专门用来生产对象。

抽象工厂是一个类，而工厂方法是一个函数，在纯面向对象范式里，两者的区别很大。而  C++ 支持泛型编程，不需要特意派生出子类，只要接口相同就行，所以，这两个模式在  C++ 里用起来也就更自由一些，界限比较模糊。

make_unique()、make_shared() 这两个函数，就是工厂模式的具体 应用，它们封装了创建的细节，看不见 new，直接返回智能指针对象，而且接口更简洁， 内部有更多的优化。

### 结构型模式

结构型模式关注的是对象的静态联系，以灵活、可拆卸、可装配的方式组合出新的对象。

![](D:\share\InterviewCpp\impl\cpp\img\structure_principle.png)

常用的是适配器、外观和代理。

####  适配器模式

适配器模式的目的是接口转换，不需要修改源码，就能够把一个对象转换成可以在本系统中 使用的形式。

####  外观模式

外观模式封装了一组对象，目的是简化这组对象的通信关系，提供一个高层次的 易用接口，让外部用户更容易使用，降低系统的复杂度。

外观模式的特点是内部会操作很多对象，然后对外表现成一个对象。使用它的话，你就可以 不用“事必躬亲”了，只要发一个指令，后面的杂事就都由它代劳了，就像是一个“大管 家”。

#### 代理模式

它和适配器有点像，都是包装一个对象，但关键在于它们的目的、意图有差异：不是为了适 配插入系统，而是要“控制”对象，不允许外部直接与内部对象通信，所以叫作“代理”。 代理模式的应用非常广泛，如果你想限制、屏蔽、隐藏、增强或者优化一个类，就可以使用 代理。这样，客户代码看到的只是代理对象，不知道原始对象（被代理的对象）是什么样， 只能用代理对象给出的接口，这样就实现了控制的目的。

### 行为模式

行为模式描述了对象之间动态的 消息传递，也就是对象的“行为”、工作的方式。

![](D:\share\InterviewCpp\impl\cpp\img\behavior_principle.png)

















