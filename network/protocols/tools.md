# tcpdump

## 捕获及停止条件  

- D 列举所有网卡设备
- -i 选择网卡设备
- -c 抓取多少条报文
-  --time-stamp-precision 指定捕获时的时间精度，默认毫秒 micro，可选纳秒 nano
-  -s 指定每条报文的最大字节数，默认 262144 字节  

## 文件操作

- -w 输出结果至文件（可被Wireshark读取分析）
- -C 限制输入文件的大小，超出后以后缀加 1 等数字的形式递增。注意单位是 1,000,000 字节
- -W 指定输出文件的最大数量，到达后会重新覆写第 1 个文件
- -G 指定每隔N秒就重新输出至新文件，注意-w 参数应基于 strftime 参数指定文件名
- -r 读取一个抓包文件
- -V 将待读取的多个文件名写入一个文件中，通过读取该文件同时读取多个文件  

![](./img/tcp_dump_strftime.png)

## 输出时间戳格式

- -t 不显示时间戳
- -tt 自 1970年 1 月 1 日 0 点至今的秒数
- -ttt 显示邻近两行报文间经过的秒数
- -tttt 带日期的完整时间
- -ttttt 自第一个抓取的报文起经历的秒数  

## 分析信息详情

- -e 显示数据链路层头部
- -q 不显示传输层信息
- -v 显示网络层头部更多的信息，如 TTL、id 等
- -n 显示 IP 地址、数字端口代替 hostname 等
- -S TCP 信息以绝对序列号替代相对序列号
- -A 以 ASCII 方式显示报文内容，适用 HTTP 分析
- -x 以 16 进制方式显示报文内容，不显示数据链路层
- -xx 以 16 进制方式显示报文内容，显示数据链路层
- -X 同时以 16 进制及 ACII 方式显示报文内容，不显示数据链路层
- -XX 同时以 16 进制及 ACII 方式显示报文内容，显示数据链路层  

# netstat

查看 TCP 状态。

- interval: 重新显示选定的统计信息，各个显示间暂停的间隔秒数
- -a: 显示所有连接和侦听端口
- -n: 以数字形式（如 IP 地址）显示地址和端口号
- -r: 显示路由表
- -s: 显示每个协议的统计信息
- -o(Windows): 显示拥有的与每个连接关联的进程 ID
- -b(Windows)/-p(Linux) : 显示对应的可执行程序名字





